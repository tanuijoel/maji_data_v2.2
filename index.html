<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wasreb</title>
    <link href="styles.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/flowbite@1.5.3/dist/flowbite.min.css" />
    <script src="https://unpkg.com/flowbite@1.5.3/dist/flowbite.js" defer></script>
    <script src="./script/circular-progress.js" defer type="module"></script>
	<link rel="stylesheet" href="https://openlayers.org/en/v6.2.1/css/ol.css" type="text/css">
    <!-- Openlayers -->
    <link rel="stylesheet" href="https://openlayers.org/en/latest/legacy/ol.css" />
    <!-- ol-ext -->
    <link rel="stylesheet" href="./dist/ol-ext.min.css" />
    <style>
        #map {
          width: 100%;
          height: 930px;
        }
     
     </style>
</head>
    <body class="font-body min-h-screen flex flex-col justify-center align-middle">
        <header class="border-b border-slate-300">
            <div class="container mx-auto py-6 flex justify-between">
                <div class="basis-3/10"><img src="./img/wasreb-logo.png" class="h-12"></div>

                <div class="basis-7/10 flex justify-between">
                    <div class="basis-1/2 mr-2 flex justify-end">
                        <input placeholder="Search" type="search" name="search" id="main-search">
                    </div>
                    <nav class="basis1/2">
                        <ul class="m-0 p-0 list-none bg-slate-800 text-slate-100 uppercase rounded-sm overflow-hidden mt-2">
                            <li class="inline-block py-2 px-12 bg-slate-700 text-sm font-medium">
                                <a href="#">Request for data</a>
                            </li>
                            <li class="inline-block py-2 px-6 text-sm font-medium">
                                <a href="#">Contact Us</a>
                            </li>
                        </ul>
                    </nav>
                </div>

               
            </div>

           
        </header>
        <main class="flex-grow relative">
            <div class="w-full">
				<div id="map"></div>
            </div>
            <nav id="layers" style="font-family:inherit!important; width: fit-content !important; height: fit-content !important;  font-size: 13px; color: white" class="z-40 w-72 absolute top-12 left-20 bg-slate-700/95 py-2 px-4 rounded-md border border-slate-200 shadow-md">
                <div id="layer-toggle" class="py-2 border-b border-slate-500">
                    <div class="flex justify-between">
                        <div class="flex justify-start">
                            <div class="mr-4">
                                <svg class="h-5 w-5 text-slate-200" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
                                    xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 384 384"
                                    style="enable-background:new 0 0 384 384;" xml:space="preserve">
                                    <style type="text/css">
                                        .st0 {
                                            fill: #FFFFFF;
                                        }
                                    </style>
                                    <g>
                                        <path class="st0"
                                            d="M0,129.7c0-4,0-8,0-12c0.2-0.5,0.5-0.9,0.6-1.4c2.9-17.8,12.8-30.4,28.7-38.8C66.6,58,103.7,37.9,141.2,18.5
                                                            		c32.6-17,65.9-17.5,99-1.3C253.6,23.7,266.7,31,280,38c25.4,13.4,50.8,26.8,76.1,40.3c13.2,7,21.9,17.5,26,31.8
                                                            		c0.7,2.5,1.2,5.1,1.9,7.6c0,4,0,8,0,12c-0.2,0.3-0.5,0.6-0.5,1c-2.9,18.3-13.2,30.9-29.4,39.5c-36.4,19.3-72.6,38.9-108.9,58.4
                                                            		c-34,18.2-68.6,19.4-103,1.6c-39.1-20.3-77.8-41.4-116.5-62.4c-12.2-6.6-20-17.1-23.8-30.4C1.2,134.8,0.6,132.3,0,129.7z
                                                            		 M192.4,212.6c12.7,0.1,25-3.2,36.5-9.4c37.6-20.2,75.2-40.4,112.8-60.5c7.7-4.1,12.2-10.3,12.1-19.2c0-8.7-4.4-14.8-12.1-18.8
                                                            		c-38.1-20.1-76-40.5-114.2-60.3c-23.9-12.4-48.3-12-72.2,0.5c-37.7,19.7-75.2,39.8-112.9,59.6c-7.7,4.1-12.4,10.1-12.4,19
                                                            		c-0.1,9,4.6,15.2,12.4,19.4c37.4,20,74.8,40.1,112.2,60.2C166.3,209.2,178.7,212.6,192.4,212.6z" />
                                        <path class="st0" d="M384,216.7c-2.1,5.9-6.6,9.2-12,12.1c-42.3,22.5-84.5,45.3-126.7,67.9c-35.4,18.9-70.9,19-106.3,0.1
                                                            		c-42.3-22.5-84.6-45-127-67.3c-5.4-2.8-9.8-6.2-12-12.1c0-2.3,0-4.5,0-6.8c2.1-5.3,5.3-9.6,11.2-11.1c4.6-1.2,8.8,0.1,12.9,2.3
                                                            		c42.8,22.8,85.8,45.4,128.6,68.3c26.4,14.2,52.6,14.1,79-0.2c42.1-22.8,84.4-45.3,126.7-68c12.4-6.7,19.6-4.4,25.7,7.9
                                                            		C384,212.2,384,214.5,384,216.7z" />
                                        <path class="st0" d="M0,278.2c2.1-5.3,5.3-9.6,11.2-11.1c4.6-1.2,8.8,0.1,12.9,2.3c42.9,22.8,85.8,45.4,128.6,68.3
                                                            		c26.5,14.2,52.6,14.1,79-0.1c42.2-22.8,84.4-45.3,126.6-68c12.4-6.7,19.6-4.4,25.7,7.9c0,2.3,0,4.5,0,6.8c-2.1,5.9-6.6,9.2-12,12.1
                                                            		c-42.4,22.6-84.7,45.4-127,68.1c-35.3,18.8-70.7,18.7-106,0c-42.3-22.5-84.6-45-127-67.3c-5.4-2.8-9.8-6.2-12-12.1
                                                            		C0,282.7,0,280.5,0,278.2z" />
                                    </g>
                                </svg>
                            </div>
                            <div>
                                <p class="uppercase text-white font-bold">Layers</p>
                            </div>
                        </div>
                        <div>
                            <svg class="w-6 h-6 text-slate-200" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                <div id="layer-items" class="my-6">
				    <div class="ml-4 col-15 external layerSwitcher"></div>
                </div>
            </nav>

            <nav id="indicators" class="z-40 w-72 absolute top-12 right-20 bg-slate-50 py-2 px-4 rounded-md border border-slate-500 shadow-md">
                <div id="indicators-toggle">
                    <div class="flex justify-between">
                        <div class="flex justify-start">
                            <div class="mr-4">
                                <svg class="w-5 h-5 mr-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="uppercase text-slate-800 font-bold">indicators</p>
                            </div>
                        </div>
                        <div>
                            <svg class="w-6 h-6 text-slate-800" fill="none" stroke="currentColor" viewBox="0 0 24 24"
                                xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </div>
                    </div>
                </div>

                <div id="indicator-items" class="border-t border-slate-400 my-2 py-2">
                    <h3 class="text-slate-700 text-center font-bold">National water coverage %</h3>
                    <div class="flex justify-between my-8">
                        <div class="basis-2/5 flex flex-col justify-center">
                            <div data-end-value="57" class="circular-progress circular-progress-small mx-auto">
                                <div class="value-container value-container-small text-slate-600">0%</div>
                            </div>
                        </div>
                        <div class="basis-3/5">
                            <div id="sector-benchmarks" class="text-center">
                                <h2 class="font-bold uppercase text-center text-xs border-b border-slate-300 mb-2">Sector benchmarks
                                </h2>
                                <div id="benchmarks">
                                    <div class="benchmark-small bg-red-500 border border-red-300">
                                        <p class="benchmark-small-text p-0 m-0">&lt; 80</p>
                                        <p class="benchmark-small-text p-0 m-0">Not acceptable</p>
                                    </div>
                                    <div class="benchmark-small bg-orange-400 border border-orange-200">
                                        <p class="benchmark-small-text p-0 m-0">80 - 90</p>
                                        <p class="benchmark-small-text p-0 m-0">Acceptable</p>
                                    </div>
                                    <div class="benchmark-small bg-green-400 border border-green-200">
                                        <p class="benchmark-small-text p-0 m-0">&gt; 90</p>
                                        <p class="benchmark-small-text p-0 m-0">Good</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="metrics">
                        <div class="metric-container">
                            <div class="metric-element border border-slate-300">
                                <img src="./img/icons/drinking-water-01.svg" class="h-4 w-4 mx-auto">
                            </div>
                            <div class="flex flex-col justify-center">
                                <p class="metric-label text-xs">Non Revenue Water %</p>
                            </div>
                            <div class="metric-element bg-red-500">
                                <p id="nrw">0</p>
                            </div>
                        </div>

                        <div class="metric-container">
                            <div class="metric-element border border-slate-300">
                                <img src="./img/icons/clock-04.svg" class="h-4 w-4 mx-auto">
                            </div>
                            <div class="flex flex-col justify-center">
                                <p class="metric-label text-xs">Staff Productivity</p>
                            </div>
                            <div class="metric-element bg-amber-500">
                                <p id="staff_productivity">0</p>
                            </div>
                        </div>

                        <div class="metric-container">
                            <div class="metric-element border border-slate-300">
                                <img src="./img/icons/cost-coverage-01.svg" class="h-4 w-4 mx-auto">
                            </div>
                            <div class="flex flex-col justify-center">
                                <p class="metric-label text-xs">Metring Ratio %</p>
                            </div>
                            <div class="metric-element bg-green-500">
                                <p class="p-10" id="metering_ratio">0</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-700 mt-4 -mx-4 -mb-2 p-4 text-slate-400 flex justify-between rounded-md">
                    <div class="basis-1/2">
                        <div class="mb-6">
                         <p class="meta-label">Total population served</p>
                         <p id="population_served" class="font-bold text-1xl">0</p>
                        </div>

                         <div>
                             <p class="meta-label">Total active water connections</p>
                             <p id="active_water_connections" class="font-bold text-1xl">0</p>
                         </div>
                     </div>
                     <div class="basis-1/2 pl-2 border-l border-slate-500">
                         <div class="mb-6">
                             <p class="meta-label">Total population in service area</p>
                             <p id="population_service_area" class="font-bold text-1xl">0</p>
                         </div>
                     
                         <div>
                             <p class="meta-label">Total water produced (M<sup>3</sup>)</p>
                             <p id="water_produced"class="font-bold text-1xl">0</p>
                         </div>
                     </div>
                </div>
            </nav>
        </main>
        <footer>

<!-- drawer init and toggle -->
<div class="text-center">
    <button
        class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 focus:outline-none dark:focus:ring-blue-800"
        type="button" data-drawer-target="drawer-swipe" data-drawer-show="drawer-swipe" data-drawer-placement="bottom"
        data-drawer-edge="true" data-drawer-edge-offset="bottom-[60px]" aria-controls="drawer-swipe">
        About Majidata
    </button>
</div>

<!-- drawer component -->
<div id="drawer-swipe"
    class="fixed z-40 w-full overflow-y-auto bg-slate-800 border-t border-slate-200 rounded-t-sm
    tabindex="-1" aria-labelledby="drawer-swipe-label">
    <div class="p-4 cursor-pointer hover:bg-slate-700-50" data-drawer-toggle="drawer-swipe">
        <span class="absolute w-8 h-1 -translate-x-1/2 bg-slate-600 rounded-sm top-3 left-1/2"></span>
        <h5 id="drawer-swipe-label" class="inline-flex items-center text-sm uppercase text-slate-200 font-medium">
            <svg class="w-5 h-5 mr-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>About&nbsp;<span class="font-bold">MajiData</span></h5>
    </div>
    <div class="container mx-auto flex justify-between pb-12 text-slate-200">
        <div>Majidata</div>
        <div>Partner</div>
    </div>
</div>

        </footer>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

        <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
        <script type="text/javascript" src="https://openlayers.org/en/latest/legacy/ol.js"></script>
        <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=requestAnimationFrame,Element.prototype.classList,URL,Object.assign"></script>
        <script type="text/javascript" src="./dist/ol-ext.js"></script>
        <!-- Pointer events polyfill for old browsers, see https://caniuse.com/#feat=pointer -->
        <script src="https://unpkg.com/elm-pep"></script>
        <script type="module">
            import showProgressBar from './script/show-progress-bar.js'

            const progressBars = Array.from(document.querySelectorAll('.circular-progress'))

            // TANUI: make your changes here. Ignore everythig above
            //  the lowerThreshold and upperThreshold figures are based on the sector benchmark for each KPI
            progressBars.forEach(progressBar =>
                showProgressBar({
                    lowerThreshold: 80,
                    upperThreshold: 90,
                    progressBar
                })
            )
        </script>
		 <script>
            $(document).ready(function() {
            //$('.js-example-basic-multiple').select2();
            //$('.main').css('font-size', ($(window).width()*0.01)+'px');
            });
          </script>
          <!-- Make sure you put this AFTER Leaflet's CSS -->
          <script type="text/javascript">
            get_analytics_geojson();

           async function get_analytics_geojson(){

            let res = await axios.get('http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=PUBLIC_PORTAL%3Akpi_county&maxFeatures=50&outputFormat=application%2Fjson');  
            const all_indicators = JSON.parse(JSON.stringify(res.data.features));

            console.log("RES", all_indicators);
            let sum_ps = 0;
            let sum_psa = 0;
            let wp = 0;
            let bv = 0;
            let nac = 0;
            let ntc = 0;

            let awc = 0;
            let nmc = 0;


            for (let i = 0; i < all_indicators.length; i++) {
                const pop_served = all_indicators[i].properties.population_served;
                const pop_service_area = all_indicators[i].properties.population_service_area;

                const water_produced = all_indicators[i].properties.water_produced;
                const billed_volume = all_indicators[i].properties.billed_volume;

                const active_connections = all_indicators[i].properties.active_connections;
                const staff_total = all_indicators[i].properties.staff_total;

                const active_water_connections = all_indicators[i].properties.active_water_connections;
                const metered_connections = all_indicators[i].properties.metered_connections;

               //Water coverge
                sum_ps += pop_served;
                sum_psa += pop_service_area;

                //Non Revenue Water
                wp += water_produced;
                bv += billed_volume;

                //Staff productivity
                nac += active_connections;
                ntc += staff_total;

                //Metering Ratio
                awc += active_water_connections;
                nmc += metered_connections;

            }
            console.log("Water produced", bv);
            let national_water_coverage = ((sum_ps/sum_psa) * 100).toFixed(1);
            let non_revenue_water = (((wp-bv)/wp) * 100).toFixed(1);
            let staff_productivity = ((ntc/nac) * 1000).toFixed(1);
            let metering_ratio = (((nmc/awc)) * 100).toFixed(1);

            $('#nrw').html(non_revenue_water);
            $('#staff_productivity').html(staff_productivity);
            $('#metering_ratio').html(metering_ratio);
            $('#population_served').html(sum_ps.toLocaleString());
            $('#population_service_area').html(sum_psa.toLocaleString());
            $('#active_water_connections').html(awc.toLocaleString());
            $('#water_produced').html(wp.toLocaleString());

            console.log("Natioanl", nmc);
           // $('#myTable tbody').append('<tr class ="table_class" id="table_id" data-name="' + name + '"><td>XXXX</td></tr>');
           //$('#water_coverage').append('<div data-end-value="' + national_water_coverage + '" class="circular-progress circular-progress-small mx-auto"><div class="value-container value-container-small text-slate-600">0%</div></div>');
          // $("#water_coverage").data-end("92", national_water_coverage);

          //var startTime = national_water_coverage.getAttribute('data-end-value');
         // var startTime = $('.water_coverage').getAttribute('data-end-value');
         // console.log("Startr",startTime)


         const element = document.querySelector("#water_coverage");
         delete element.dataset.attributeName;

         //const t = '67';
        // $("#water_coverage").attr("data-end-value", t); 
         //console.log($("#water_coverage").data("end-value"));

        
        }


          var popup = new ol.Overlay({ element: document.getElementById('popup')});

           let bounds = [3063570.01,-421505.86, 5389701.65Â ,312289.62];
           let format  = 'image/png';
           let asa = new ol.source.TileWMS({
                      url: 'http://102.37.157.16:8080/geoserver/WASREB/wms?authkey=488c54cd-6392-4d20-953d-b522f791a23e',
                      params: {'FORMAT': 'image/png', 
                              'VERSION': '1.1.1',
                              tiled: true,
                            "AUTHKEY": '488c54cd-6392-4d20-953d-b522f791a23e',
                            "STYLES": '',
                            "LAYERS": 'WASREB:actual_service_area',
                            "exceptions": 'application/vnd.ogc.se_inimage',
                            tilesOrigin: 3797753 + "," + -519815.0625
                        }
                      })

                      let county_boundaries = new ol.source.TileWMS({
                          url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                          params: {'FORMAT': 'image/png', 
                                  'VERSION': '1.1.1',
                                  tiled: true,
                                "STYLES": '',
                                "LAYERS": 'WASREB:county',
                                "exceptions": 'application/vnd.ogc.se_inimage',
                            tilesOrigin: 3774876 + "," + -521207.03125
                          }
                        })

                       let licensed_service_Area = new ol.source.TileWMS({
                              url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                              params: {'FORMAT': format, 
                                      'VERSION': '1.1.1',
                                      tiled: true,
                                    "STYLES": '',
                                    "LAYERS": 'WASREB:licensed_service_area',
                                    "exceptions": 'application/vnd.ogc.se_inimage',
                                tilesOrigin: 35.654788970947266 + "," + -383890.0625
                              }
                          })
                          
                      let low_income_area = new ol.source.TileWMS({
                            url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                            params: {'FORMAT': format, 
                                    'VERSION': '1.1.1',
                                    tiled: true,
                                  "STYLES": '',
                                  "LAYERS": 'WASREB:low_income_area',
                                  "exceptions": 'application/vnd.ogc.se_inimage',
                              tilesOrigin: -59942.10546875 + "," + 9545509
                            }
                        }) 

                     let sanitation_facilities = new ol.source.TileWMS({
                          url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                          params: {'FORMAT': format, 
                                  'VERSION': '1.1.1',
                                  tiled: true,
                                "STYLES": '',
                                "LAYERS": 'WASREB:sanitation_facility',
                                "exceptions": 'application/vnd.ogc.se_inimage',
                            tilesOrigin: 3919555.25 + "," + -46950.8671875
                          }
                      })

                     let sewer_manhole =  new ol.source.TileWMS({
                          url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                          params: {'FORMAT': format, 
                                  'VERSION': '1.1.1',
                                  tiled: true,
                                "STYLES": '',
                                "LAYERS": 'WASREB:sewer_manhole',
                                "exceptions": 'application/vnd.ogc.se_inimage',
                            tilesOrigin: 3837016.75 + "," + -134548.046875
                          }
                        })

                      let sewer_pipeline =  new ol.source.TileWMS({
                            url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                            params: {'FORMAT': format, 
                                    'VERSION': '1.1.1',
                                    tiled: true,
                                  "STYLES": '',
                                  "LAYERS": 'WASREB:sewer_pipeline',
                                  "exceptions": 'application/vnd.ogc.se_inimage',
                              tilesOrigin: 3864569.5 + "," + -134548.046875
                            }
                          })

                        let sssp_shemes =  new ol.source.TileWMS({
                            url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                            params: {'FORMAT': format, 
                                    'VERSION': '1.1.1',
                                    tiled: true,
                                  "STYLES": '',
                                  "LAYERS": 'WASREB:sssp_scheme',
                                  "exceptions": 'application/vnd.ogc.se_inimage',
                              tilesOrigin: 3778598 + "," + -522885.53125
                            }
                          })

                        let wwda =  new ol.source.TileWMS({
                              url: 'http://102.37.157.16:8080/geoserver/WASREB/wms',
                              params: {'FORMAT': format, 
                                      'VERSION': '1.1.1',
                                      tiled: true,
                                    "STYLES": '',
                                    "LAYERS": 'WASREB:wwda',
                                    "exceptions": 'application/vnd.ogc.se_inimage',
                                tilesOrigin: -67084.8046875 + "," + 9482734
                              }
                            })


                            //Indicators

                        let water_coverage = new ol.source.TileWMS({
                                url: 'http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/wms',
                                params: {'FORMAT': format, 
                                        'VERSION': '1.1.1',
                                        tiled: true,
                                      "STYLES": '	county_water_coverage',
                                      "LAYERS": 'PUBLIC_PORTAL:kpi_county',
                                      "exceptions": 'application/vnd.ogc.se_inimage',
                                  tilesOrigin: 3774876.0657275263 + "," + -521207.0057444413
                                }
                          })

                          let non_revenue_water = new ol.source.TileWMS({
                                url: 'http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/wms',
                                params: {'FORMAT': format, 
                                        'VERSION': '1.1.1',
                                        tiled: true,
                                      "STYLES": '	nrw',
                                      "LAYERS": 'PUBLIC_PORTAL:kpi_county',
                                      "exceptions": 'application/vnd.ogc.se_inimage',
                                  tilesOrigin: 3774876.0657275263 + "," + -521207.0057444413
                                }
                          })

                          let metering_ratio = new ol.source.TileWMS({
                                url: 'http://102.37.157.16:8080/geoserver/PUBLIC_PORTAL/wms',
                                params: {'FORMAT': format, 
                                        'VERSION': '1.1.1',
                                        tiled: true,
                                      "STYLES": '	metering_ratio',
                                      "LAYERS": 'PUBLIC_PORTAL:kpi_county',
                                      "exceptions": 'application/vnd.ogc.se_inimage',
                                  tilesOrigin: 3774876.0657275263 + "," + -521207.0057444413
                                }
                          })

            // list of layers
            var layers = [	
              
              // new ol.layer.Tile({ source: new ol.source.Stamen({ layer: 'toner-background' }), title:'toner-background' }),
              // new ol.layer.Tile({ source: new ol.source.Stamen({ layer: 'terrain-background' }), title:'terrain-background' }),
              // new ol.layer.Tile({ source: new ol.source.Stamen({ layer: 'toner-lines' }), title:'toner-lines' }),
              new ol.layer.Group({ title: '<b>BASEMAPS</b><br>', openInLayerSwitcher: true, layers: [
              new ol.layer.Tile({ visible: true, source:  new ol.source.OSM(), title:'Basemap OSM' }),
              new ol.layer.Tile({ visible: false ,source: new ol.source.Stamen({ layer: 'terrain-background' }), title:'terrain-background' }),
              new ol.layer.Tile({ visible: false ,source: new ol.source.Stamen({ layer: 'toner-lines' }), title:'toner-lines' }),
              ]}),
              new ol.layer.Group({ title: '<b>WATER UTILITIES AND SERVICE AREAS</b>', openInLayerSwitcher: true, layers: [
              new ol.layer.Tile({ visible: false, source: wwda, title:'Water Works and Development Agencies' }),
              new ol.layer.Tile({ visible: false, source: sewer_pipeline, title:'Sewer Pipelines' }),
              new ol.layer.Tile({ visible: false, source: sewer_manhole, title:'Sewer Manholes' }),
              new ol.layer.Tile({ visible: false, source: sanitation_facilities, title:'Sanitation Facilities' }),
              new ol.layer.Tile({ visible: false,source: low_income_area, title:'Low Income Areas' }),
              new ol.layer.Tile({ visible: false,source: licensed_service_Area, title:'Licensed Service Areas' }),
              new ol.layer.Tile({ visible: false, source: sssp_shemes, title:'SSSPs Schemes' }),
              new ol.layer.Tile({ visible: false, source: asa, title:'Actual Service Areas' }),
              new ol.layer.Tile({ visible: false, source: county_boundaries, title:'County Boundaries' })
              ]}),
              new ol.layer.Group({ title: '<b>PERFORMANCE INDICATORS/ANALYTICS</b><br>', openInLayerSwitcher: true, layers: [
                 new ol.layer.Tile({ visible: false, source: non_revenue_water, title:'Non Revenue Water' }),
                 new ol.layer.Tile({ visible: false, source: metering_ratio, title:'Metering Ratio' }),
                 new ol.layer.Tile({ visible: true, source: water_coverage, title:'Water Coverage' })
                 //new ol.layer.Tile({ visible: false, source: metering_ratio, title:'Metering Ratio' })
                 //new ol.layer.Tile({ source: new ol.source.Stamen({ layer: 'terrain-labels' }), title:'County Boundaries' }),
               ]})
            ];

            var osmLayer = new ol.layer.Tile({
              source: new ol.source.OSM()
            });

            
            
          
            // The Map
            let map = new ol.Map({
            
              target: 'map',
              view: new ol.View({ zoom: 15, center: [0.340505, 37.310292] }),
              layers: layers,
              overlays: [popup]
            });


            map.getView().fit(bounds, map.getSize());
            // Add a layer switcher outside the map
            var lswitcher = new ol.control.LayerSwitcher({
              target:$(".layerSwitcher").get(0), 
            });

            var fullscreen = new ol.control.FullScreen();
               map.addControl(fullscreen);

           

            map.on('singleclick', function(evt) {
             
                // Attempt to find a marker from the planningAppsLayer
                // var feature = layers.forEachFeatureAtPixel(evt.pixel, function(feature, layer) {
                //     return feature;
                // });

                //console.log("Layer", feature);

                layers.forEach(function(l){

                     if (l.getLayers) {

                        console.log("Layers", l.getLayers().getArray());

                     }

                });

                
            });


            //class="form-control" style="margin-bottom:20px !important;"
            map.addControl(lswitcher);

            // The serach input
            var search = $('<input id="main-search" class="form-control" style="color:#293445; margin-bottom:0px !important;">').attr('placeholder','Type To Filter..e.g Water Coverage');
            function filterLayers(rex, layers) {
                console.log("REX", rex);
              var found = false;
              layers.forEach(function(l){
                // Layer Group
                if (l.getLayers) {
                  if (filterLayers(rex, l.getLayers().getArray())) {
                    l.set('noLayer', false);
                    found = true;
                  } else {
                    l.set('noLayer', true);
                  }
                } else {
                  if (rex.test(l.get('title'))) {
                    l.setVisible(true);
                    found = true;
                  } else {
                    l.setVisible(false);
                  }
                }
              });
              return found;
            }
            search.on('keyup change', function(){
              var rex = new RegExp(search.val());
              filterLayers(rex, layers);
              // Force layer switcher redraw
               //layers[0].changed();
            });

            // Add search input in the switcher header
            lswitcher.setHeader(search.get(0));

            // When switcher is drawn hide/show the list item according to its visility
            lswitcher.on('drawlist', function(e) {
              // Hide Layer Group with no layers visible
              if (e.layer.getLayers) {
                if (e.layer.get('noLayer')) {
                  $(e.li).hide();
                } else {
                  $(e.li).show();
                }
              } else {
                var rex = new RegExp(search.val());
                if (rex.test(e.layer.get('title'))) {
                  $(e.li).show();
                } else {
                  $(e.li).hide();
                }
              }
            });

           
      </script>

    </body>
</html>